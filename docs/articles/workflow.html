<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Workflow • Pmetrics</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="workflow_files/libs/quarto-html/popper.min.js"></script><script src="workflow_files/libs/quarto-html/tippy.umd.min.js"></script><link href="workflow_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="workflow_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Workflow">
<meta property="og:image" content="https://lapkb.github.io/Pmetrics/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Pmetrics</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/pmetrics.html">Start Here</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/intro.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/overview.html">Overview</a></li>
    <li><a class="dropdown-item" href="../articles/workflow.html">Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/data.html">Data Objects</a></li>
    <li><a class="dropdown-item" href="../articles/models.html">Model Objects</a></li>
    <li><a class="dropdown-item" href="../articles/running.html">Running the fit</a></li>
    <li><a class="dropdown-item" href="../articles/objects.html">Created Objects</a></li>
    <li><a class="dropdown-item" href="../articles/simulation.html">Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/plotly.html">Plotly plots</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/LAPKB/Pmetrics/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Workflow</h1>




      <small class="dont-index">Source: <a href="https://github.com/LAPKB/Pmetrics/blob/HEAD/vignettes/workflow.qmd" class="external-link"><code>vignettes/workflow.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <section class="level2"><h2 id="general-workflow">General Workflow<a class="anchor" aria-label="anchor" href="#general-workflow"></a>
</h2>
<p><span class="r6">R6</span></p>
<p>The general Pmetrics workflow in R6 for IT2B and NPAG is shown in the following diagram.</p>
<p><img src="Images/Slide1.png"></p>
<p>The user creates the data and model objects at the top. These can come from the hard drive or from within R (dashed arrows). The model file is created in R using the <code>PM_model$new()</code> function and the data file by <code>PM_data$new()</code>. When combined using <code>PM_fit$new()</code> and the <code>$run()</code> function on the resulting object, the analysis is executed. At the end of the run, the hard drive will contain a new numerically named folder, e.g., 1, 2, 3, …, that contains the files which can be loaded into R subsequently using <code>PM_load(x)</code>, replacing <code>x</code> with the folder number. <code><a href="../reference/PM_load.html">PM_load()</a></code> is an alias for <code>PM_result$new()</code> because it creates a new <code><a href="../reference/PM_result.html">PM_result()</a></code> object which contains all the results of a run, and has many assciated methods attached to it for plotting, simulating, etc.</p>
<p>To change model parameters, the model object is updated via <code>PM_model$update()</code>, <code>PM_fit$new()</code> is called and then the run is executed with <code>$run()</code>. If continuing a previous run that did not end, simply use the <code>$run()</code> and specify the run number you wish to continue as the <code>prior</code> argument to <code>$run()</code>. These scenarios are illustrated below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run 1 - ensure the data, model files are in the working directory</span></span>
<span><span class="va">data1</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_data.html">PM_data</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"data.csv"</span><span class="op">)</span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"model.txt"</span><span class="op">)</span></span>
<span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_fit.html">PM_fit</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">data1</span>, <span class="va">mod1</span><span class="op">)</span></span>
<span><span class="va">fit1</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PM_load.html">PM_load</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="co"># PM_load is an alias for PM_result$new()</span></span>
<span></span>
<span><span class="co"># Run 2 - update Ke range</span></span>
<span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="va">mod1</span><span class="op">$</span><span class="va">clone</span> <span class="co"># create an independent copy</span></span>
<span><span class="va">mod2</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Ke <span class="op">=</span> <span class="fu"><a href="../reference/ab.html">ab</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_fit.html">PM_fit</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">data1</span>, <span class="va">mod2</span><span class="op">)</span></span>
<span><span class="va">fit2</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run 3 - continue run 2</span></span>
<span><span class="va">fit2</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span>prior <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<p>The great advantage of R6 over Legacy is that in R6, you no longer need to spend time copying files from prior run folders, modifying them, and ensuring that they are in the working directory. After the initial creation of the data and model objects, everything can be done in R from memory, although results are still saved to hard drive for later retrieval.</p>
<p><span class="legacy">Legacy</span></p>
<p>The general Pmetrics workflow in Legacy for IT2B and NPAG is shown in the following diagram. The major differences compared to R6 are:</p>
<ul>
<li>
<em>Data and model</em> The data is always a .csv file, and the model is always a text file which must be edited to make changes. Both must be copied from a prior folder to the current working directory for every run.</li>
<li>
<em>Run.</em> Separate commands for NPAG and IT2B must be used, i.e. <code><a href="../reference/NPrun.html">NPrun()</a></code> and <code>ITrun()</code>.</li>
<li>
<em>Loading.</em> Results are loaded with <code><a href="../reference/PMload.html">PMload()</a></code> not <code><a href="../reference/PM_load.html">PM_load()</a></code> because the former returns a collection of results all suffixed with the run number, e.g. <code>op.1</code> or <code>final.1</code> for run 1. This can lead to confusion if working on two projects at once, or uncertainty about what is actually loaded.</li>
</ul>
<p><img src="Images/Slide2.png"></p>
<p>The user supplies the names of the data and model files as arguments to the run functions. R is used to specify the working directory containing these files. The analysis is executed in a terminal window by calling <code><a href="../reference/NPrun.html">NPrun()</a></code>, <code>ITrun()</code> or <code>ERRrun()</code> functions. The results can be loaded into R after the run completes using <code><a href="../reference/PMload.html">PMload()</a></code>. The analgous Legacy code to the R6 code above is shown here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run 1 - ensure the data, model files are in the working directory</span></span>
<span><span class="fu"><a href="../reference/NPrun.html">NPrun</a></span><span class="op">(</span><span class="st">"data.csv"</span>, <span class="st">"model.txt"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/PMload.html">PMload</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run 2 - update Ke range - edit file outside R, copy to working directory</span></span>
<span><span class="co"># use same data as for run 1</span></span>
<span><span class="fu"><a href="../reference/NPrun.html">NPrun</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">1</span>, <span class="st">"model2.txt"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run 3 - continue run 2</span></span>
<span><span class="fu"><a href="../reference/NPrun.html">NPrun</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">1</span>, model <span class="op">=</span> <span class="fl">1</span>, prior <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<p>While there are fewer lines of R code than for R6, the edits made to create model2.txt are not recorded anywhere in R, and must be made outside R, with cumbersome file copying to ensure everything is in the working directory.</p>
</section><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'light-border',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config);
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script></main>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Neely, Julián Otálvaro.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
