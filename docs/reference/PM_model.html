<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Defines the PM_model class — PM_model • Pmetrics</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Defines the PM_model class — PM_model"><meta name="description" content="
PM_model objects contain the variables, covariates, equations and error models
necessary to run a population analysis."><meta property="og:description" content="
PM_model objects contain the variables, covariates, equations and error models
necessary to run a population analysis."><meta property="og:image" content="https://lapkb.github.io/Pmetrics/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Pmetrics</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/pmetrics.html">Start Here</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/intro.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/overview.html">Overview</a></li>
    <li><a class="dropdown-item" href="../articles/workflow.html">Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/data.html">Data Objects</a></li>
    <li><a class="dropdown-item" href="../articles/models.html">Model Objects</a></li>
    <li><a class="dropdown-item" href="../articles/running.html">Running the fit</a></li>
    <li><a class="dropdown-item" href="../articles/objects.html">Created Objects</a></li>
    <li><a class="dropdown-item" href="../articles/simulation.html">Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/plotly.html">Plotly plots</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/LAPKB/Pmetrics/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Defines the PM_model class</h1>
      <small class="dont-index">Source: <a href="https://github.com/LAPKB/Pmetrics/blob/HEAD/R/PM_model.R" class="external-link"><code>R/PM_model.R</code></a></small>
      <div class="d-none name"><code>PM_model.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="figures/lifecycle-stable.svg" alt="[Stable]"></a></p>
<p>PM_model objects contain the variables, covariates, equations and error models
necessary to run a population analysis.</p>
    </div>


    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>PM_model objects are one of two fundamental objects in Pmetrics, along with
<code><a href="PM_data.html">PM_data()</a></code> objects. Defining a PM_model allows for fitting it to the data
via the <code>$fit()</code> method to conduct a
population analysis, i.e. estimating the probability distribution of model equation
paramter values in the population. The PM_model object is created using the
<code><a href="build_model.html">build_model()</a></code> function, by defining a list
directly in R, or by reading a model text file. See the vignette on models
for details.</p>
<p><strong>Some notes on the example at the end of this help page:</strong></p><ul><li><p>It's a complete example of a three compartment model with delayed absorption.</p></li>
<li><p>We show the method of defining the model first and embedding the <code>PM_model$new()</code> within
a <code>donttest</code> block to avoid automatic compilation.</p></li>
<li><p>Since this model can also be solved analytically with algebra, we could have used
<code>eqn = function(){three_comp_bolus}</code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Michael Neely</p>
    </div>
    <div class="section level2">
    <h2 id="public-fields">Public fields<a class="anchor" aria-label="anchor" href="#public-fields"></a></h2>
    <p></p><div class="r6-fields"><dl><dt><code>model_list</code></dt>
<dd><p>A list containing the model components built by translating
the original arguments into Rust</p></dd>


<dt><code>arg_list</code></dt>
<dd><p>A list containing the original arguments passed to the model</p></dd>


<dt><code>binary_path</code></dt>
<dd><p>The full path and filename of the compiled model</p></dd>


</dl><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a></h2>

<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-PM_model-new"><code>PM_model$new()</code></a></p></li>
<li><p><a href="#method-PM_model-print"><code>PM_model$print()</code></a></p></li>
<li><p><a href="#method-PM_model-plot"><code>PM_model$plot()</code></a></p></li>
<li><p><a href="#method-PM_model-fit"><code>PM_model$fit()</code></a></p></li>
<li><p><a href="#method-PM_model-map"><code>PM_model$map()</code></a></p></li>
<li><p><a href="#method-PM_model-sim"><code>PM_model$sim()</code></a></p></li>
<li><p><a href="#method-PM_model-compile"><code>PM_model$compile()</code></a></p></li>
<li><p><a href="#method-PM_model-update"><code>PM_model$update()</code></a></p></li>
<li><p><a href="#method-PM_model-clone"><code>PM_model$clone()</code></a></p></li>
</ul></div><p></p><hr><a id="method-PM_model-new"></a><div class="section">
<h3 id="method-new-">Method <code>new()</code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>
<p>This is the method to create a new <code>PM_model</code> object. If all arguments are <code>NULL</code>,
e.g. <code>mod &lt;- PM_model$new()</code> the model builder shiny app will launch by a call to <code><a href="build_model.html">build_model()</a></code>,
which will return the model object upon exit.</p>
<p>Otherwise, the first parameter allows creation of a model from a variety of pre-existing
sources, and if used, all the subsequent arguments will be ignored. If a model
is defined on the fly, the arguments form the building blocks. Blocks are of two types:</p><ul><li><p><strong>Vectors</strong> define <em>primary parameters</em>, <em>covariates</em>,
and <em>error models</em>. These
portions of the model have specific and defined creator functions and no additional
R code is permissible. They take this form:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>block_name <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="at">var1 =</span> <span class="fu">creator</span>(),</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="at">var2 =</span> <span class="fu">creator</span>()</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>)</span></code></pre><p></p></div>
<p>Note the comma separating the creator functions, "<code>c(</code>" to open the vector and "<code>)</code>" to close the vector.
Names are case-insensitive and are converted to lowercase for Rust.</p></li>
<li><p><strong>Functions</strong> define the other parts of the model, including <em>secondary (global)
equations</em>, <em>model equations</em> (e.g. ODEs), <em>lag time</em>, <em>bioavailability</em>, <em>initial conditions</em>,
and <em>outputs</em>. These parts of the model are defined as R functions without arguments,
but whose body contains any permissible R code.</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>block_name <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a> <span class="co"># any valid R code</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a> <span class="co"># can use primary or secondary parameters and covariates</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a> <span class="co"># lines are not separated by commas</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>}</span></code></pre><p></p></div>
<p>Note the absence of arguments between the "<code>()</code>", the opening curly brace "<code>{</code>" to start
the function body and the closing curly brace "<code>}</code>" to end the body.
Again, all R code will be converted to lowercase prior to translation into Rust.</p></li>
</ul><p><strong>Important:</strong> All models must have <code>pri</code>, <code>eqn</code>, <code>out</code>, and <code>err</code> blocks.</p><div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pri <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cov <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sec <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  eqn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lag <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fa <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ini <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  out <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  err <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>x</code></dt>
<dd><p>An optional argument, but if specified, all the subsequent
arguments will be ignored. <code>x</code> creates a <code>PM_model</code> from
existing appropriate input, which can be one of the following:</p><ul><li><p>Quoted name of a model text file in the
working directory which will be read and passed to Rust engine.</p></li>
<li><p>List that defines the model directly in R. This will be in the same format as if
all the subsequent arguments were used. For example:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>mod_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a> <span class="at">pri =</span> <span class="fu">c</span>(...),</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a> <span class="at">eqn =</span> <span class="cf">function</span>(){...},</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a> <span class="at">out =</span> <span class="cf">function</span>(){...},</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a> <span class="at">err =</span> <span class="fu">c</span>(...)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>mod <span class="ot">&lt;-</span> PM_model<span class="sc">$</span><span class="fu">new</span>(mod_list)</span></code></pre><p></p></div></li>
<li><p><code>PM_model</code> object, which will simply rebuild it, e.g. carrying on the
prior example: <code>PM_model$new(mod)</code></p></li>
</ul><p>See the user manual <code><a href="PM_manual.html">PM_manual()</a></code> for more help on directly defining models in R.</p></dd>


<dt><code>pri</code></dt>
<dd><p>The first of the arguments used if <code>x</code> is not specified. This is
a named vector of primary parameters, which are the model parameters that
are estimated in the population analysis. They are specified
by one of two creator functions: <code><a href="ab.html">ab()</a></code> or <code><a href="msd.html">msd()</a></code>. For example,</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>pri <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="at">Ke =</span> <span class="fu">ab</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="at">V =</span> <span class="fu">msd</span>(<span class="dv">100</span>, <span class="dv">10</span>)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>)</span></code></pre><p></p></div>
<p>The <code><a href="ab.html">ab()</a></code> creator specifies the
initial range <code>[a, b]</code> of the parameter, while the <code><a href="msd.html">msd()</a></code> creator specifies
the initial mean and standard deviation of the parameter.</p></dd>


<dt><code>cov</code></dt>
<dd><p>A vector whose names are some or all of the covariates in the data file.
Unlike prior versions of Pmetrics, as of 3.0.0, they do not have to be listed in the same order
as in the data file, and they do not need to be all present.
<strong>Only those covariates used in model equations need to be declared here.</strong>
Values for each element in the covariate vector are the <code><a href="interp.html">interp()</a></code> creator function to declare
how each covariate is interpolated between entries in the data. The default argument
for <code><a href="interp.html">interp()</a></code> is "lm" which means that values will be linearly interpolated
between entries, like the R linear model function <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">stats::lm()</a></code>. The alternative is "none",
which holds the covariate value the same as the previous entry until it changes,
i.e., a carry-forward strategy.</p>
<p>For example:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>cov <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="at">wt =</span> <span class="fu">interp</span>(), <span class="co"># will be linear by default</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="at">visit =</span> <span class="fu">interp</span>(<span class="st">"none"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>)</span></code></pre><p></p></div>
<p>Note that <code>wt = interp()</code> is equivalent to <code>wt = interp("lm")</code>, since "lm" is the default.</p></dd>


<dt><code>sec</code></dt>
<dd><p>A function defining the secondary (global) equations in the model. Values
are not estimated for these equations but they are available to every other block in the model.
For example:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>sec <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  V <span class="ot">=</span> V0 <span class="sc">*</span> (wt<span class="sc">/</span><span class="dv">70</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>}</span></code></pre><p></p></div>
<p>Note that the function
must be defined with no arguments between the parentheses,
and the body <strong>must be in R syntax</strong>. Any number of lines and R code, e.g.
<code>if</code> - <code>else</code> statements, etc. are permissible.</p></dd>


<dt><code>eqn</code></dt>
<dd><p>A function defining the model equations. The function must have no arguments.
The body of the function may contain three kinds of equations, written in R syntax.</p><ul><li><p><strong>Implicit equations</strong> referenced by calling the name of a Pmetrics model library object
detailed in <code><a href="model_lib.html">model_lib()</a></code>. The Pmetrics model library contains a number of template models
solved analytically (algebraically) and may include user-defined models. For example, to use
a two-compartment model with intavenous input:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>eqn <span class="ot">=</span> <span class="cf">function</span>(){</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a> two_comp_iv</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>}</span></code></pre><p></p></div>
<p>Required parameters for library models are listed for each model and must be
included in model blocks exactly as named. For example, in a one-compartment model
<code>Ke</code> is a required parameter. Thus, if <code>Ke</code> is a function of a covariate called "crcl",
here is a code snippet illustrating the inclusion of the required parameter.</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>mod <span class="ot">&lt;-</span> PM_model<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="at">pri =</span> <span class="fu">c</span>(</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>    <span class="at">ke0 =</span> <span class="fu">ab</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    <span class="at">v =</span> <span class="fu">ab</span>(<span class="dv">0</span>, <span class="dv">100</span>)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  ),</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="at">cov =</span> <span class="fu">c</span>(</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>    <span class="at">crcl =</span> <span class="fu">interp</span>()</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  ),</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>  <span class="at">eqn =</span> <span class="cf">function</span>(){</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    one_comp</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>    ke <span class="ot">=</span> ke0 <span class="sc">*</span> crcl <span class="co"># the required parameter, ke, is defined</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>  },</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>  ... <span class="co"># more model blocks, including out, err</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>)</span></code></pre><p></p></div></li>
<li><p><strong>Explicit equations</strong> are ordinary differential equations that directly define a model.
Use the following notation in equations:</p><ul><li><p><code>dx[i]</code> for the change in amount with respect to time (i.e., \(dx/dt\)),
where <code>i</code> is the compartment number,</p></li>
<li><p><code>x[i]</code> for the compartment amount, where <code>i</code> is the compartment number.</p></li>
<li><p><code>rateiv[j]</code> for the infusion rate of input <code>j</code>, where <code>j</code> is the input number
in the data corresponding to doses for that input.</p></li>
<li><p>Bolus doses are indicated by <code>DUR = 0</code> for dose events in the
data. Currently only one bolus input is allowed, which goes into compartment 1
and is not modifiable. It does not appear in the differential equations.</p>
<p>For example,</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>eqn <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a> dx[<span class="dv">1</span>] <span class="ot">=</span> <span class="sc">-</span>ka <span class="sc">*</span> x[<span class="dv">1</span>]</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a> dx[<span class="dv">2</span>] <span class="ot">=</span> rateiv[<span class="dv">1</span>] <span class="sc">+</span> ka <span class="sc">*</span> x[<span class="dv">1</span>] <span class="sc">-</span> ke <span class="sc">*</span> x[<span class="dv">2</span>]</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>}</span></code></pre><p></p></div></li>
</ul></li>
<li><p><strong>Additional equations</strong> in R code can be defined in this block, which are similar to
the <code>sec</code> block, but will only be available within the <code>eqn</code> block as opposed
to global availability when defined in <code>sec</code>. They can be added to either</p></li>
</ul></dd>


<dt><code>lag</code></dt>
<dd><p>A function defining the lag time (delayed absorption) for the bolus input.
The function must have no arguments,
and the equations must be defined
in R syntax The equations must be defined in the form of
<code>tlag[i] = par</code>, where <code>tlag[i]</code> is the lag for drug (input) <code>i</code> and
<code>par</code> is the lag parameter used in the <code>pri</code> block.</p>
<p>For example, if
<code>antacid</code> is a covariate in the data file, and <code>lag1</code> is a primary parameter,
this code could be used to model delayed absorption if an antacid is present.</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>lag <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  tlag[<span class="dv">1</span>] <span class="ot">=</span> <span class="cf">if</span>(antacid <span class="sc">==</span> <span class="dv">1</span>) lag1 <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>}</span></code></pre><p></p></div>
<p>As for <code>eqn</code>, additional equations in R code can be defined in this block,
but will only be available within the <code>lag</code> block.</p></dd>


<dt><code>fa</code></dt>
<dd><p>A function defining the bioavailability (fraction absorbed) equations,
similar to <code>lag</code>.</p>
<p>Example:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>fa <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  fa[<span class="dv">1</span>] <span class="ot">=</span> <span class="cf">if</span>(antacid <span class="sc">==</span> <span class="dv">1</span>) fa1 <span class="cf">else</span> <span class="dv">1</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>}</span></code></pre><p></p></div>
<p>As for <code>eqn</code>, additional equations in R code can be defined in this block,
but will only be available within the <code>fa</code> block.</p></dd>


<dt><code>ini</code></dt>
<dd><p>A function defining the initial conditions for a compartment
in the model. Structure is similar to <code>lag</code> and <code>fa</code>.</p>
<p>Example:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>ini <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  x[<span class="dv">2</span>] <span class="ot">=</span> init2 <span class="sc">*</span> V</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>}</span></code></pre><p></p></div>
<p>This sets the initial amount of drug in compartment 2 to the value
of a covariate <code>init2</code> multiplied by the volume of the compartment,
<code>V</code>, assuming <code>V</code> is either a primary parameter or defined in the
<code>sec</code> block.</p>
<p>As for <code>eqn</code>, additional equations in R code can be defined in this block,
but will only be available within the <code>ini</code> block.</p></dd>


<dt><code>out</code></dt>
<dd><p>A function defining the output equations, which are the predictions
from the model. The function must have no arguments,
and the equations for predictions must be defined
in R syntax.</p>
<p>Use the following notation in equations:</p><ul><li><p><code>y[i]</code> for the predicted value, where <code>i</code> is the output equation number,
typically corresponding to an observation with <code>outeq = i</code> in the data, but not
always (see <strong>Note</strong> below).</p></li>
<li><p><code>x[j]</code> for the compartment amount, where <code>j</code> is the compartment number.</p></li>
</ul><p>As with all function blocks, secondary equations are permitted,
but will be specific to the <code>out</code> block.</p>
<p>For example,</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>out <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  V <span class="ot">=</span> V0 <span class="sc">*</span> wt <span class="co"># only needed if not included in sec block</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  y[<span class="dv">1</span>] <span class="ot">=</span> x[<span class="dv">1</span>]<span class="sc">/</span>V</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="co">#Vp and Vm must be defined in pri or sec blocks</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  y[<span class="dv">2</span>] <span class="ot">=</span> x[<span class="dv">2</span>]<span class="sc">/</span>Vp</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  y[<span class="dv">3</span>] <span class="ot">=</span> x[<span class="dv">3</span>]<span class="sc">/</span>Vm</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>}</span></code></pre><p></p></div>
<p>This assumes <code>V</code>, <code>Vp</code>, and <code>Vm</code> are either primary parameters or defined in the
<code>sec</code> block.</p>
<p><strong>Note</strong> that as of Pmetrics 3.0.0, you can have more output equations
than values for <code>outeq</code> in the data. This is not possible with prior
versions of Pmetrics. Outputs without corresponding observations
are not used in the fitting, but do generate predictions.
For example, this snippet is part of a model that calculates AUC:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>eqn <span class="ot">=</span> <span class="cf">function</span>(){</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  dx[<span class="dv">1</span>] <span class="ot">=</span> <span class="sc">-</span>ka <span class="sc">*</span> x[<span class="dv">1</span>]</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  dx[<span class="dv">2</span>] <span class="ot">=</span> rateiv[<span class="dv">1</span>] <span class="sc">+</span> ka <span class="sc">*</span> x[<span class="dv">1</span>] <span class="sc">-</span> ke <span class="sc">*</span> x[<span class="dv">2</span>]</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  dx[<span class="dv">3</span>] <span class="ot">=</span> x[<span class="dv">2</span>] <span class="sc">-</span> x[<span class="dv">3</span>]</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  dx[<span class="dv">4</span>] <span class="ot">=</span> x[<span class="dv">1</span>] <span class="sc">/</span> v</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>},</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>out <span class="ot">=</span> <span class="cf">function</span>(){</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  y[<span class="dv">1</span>] <span class="ot">=</span> x[<span class="dv">1</span>]<span class="sc">/</span>v</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>  y[<span class="dv">2</span>] <span class="ot">=</span> x[<span class="dv">4</span>]</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>},</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>err <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a> <span class="fu">proportional</span>(<span class="dv">2</span>, <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>)</span></code></pre><p></p></div>
<p>If the data only contain observations for <code>y[1]</code>, i.e. the concentration
of drug in the plasma compartment with <code>outeq = 1</code>, the model will
use that information to optimize the parameter values, but will also
generate predictions for <code>y[2]</code>, which is the AUC of the drug in compartment 1,
even though there is no <code>outeq = 2</code> in the data. There is only one <code>err</code>
equation since there is only one source of observations: plasma concentration.
AUC (<code>y[2]</code>) is not fitted to any observations; it is a calculation based on
the model state, given the optimized parameter values. It's not required, but
shown here for illustrative purposes.</p></dd>


<dt><code>err</code></dt>
<dd><p>An unammed vector of error models for each of the output equations
with observations, i.e. those that have an <code>outeq</code> number associated with them in
the data.
Each error model is defined by the <code><a href="proportional.html">proportional()</a></code> creator or
the <code><a href="additive.html">additive()</a></code> creator, relative to the observation error.
For example, if there are three output equations corresponding to three
sources of observations in the data, the error models
could be defined as:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>err <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="fu">proportional</span>(<span class="dv">2</span>, <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="dv">0</span>, <span class="dv">0</span>)),</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="fu">proportional</span>(<span class="dv">3</span>, <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="dv">0</span>, <span class="dv">0</span>)),</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="fu">additive</span>(<span class="dv">1</span>, <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.25</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>)</span></code></pre><p></p></div>
<p>This defines the first two output equations to have proportional error
with initial values of 2 and 3, respectively, and the third output equation
to have additive error with initial value of 1. Each output is measured by
a different assay with different error characteristics.</p>
<p>If all the output equations have the same error model, you can
simply use a single error model embedded in <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate()</a></code> , e.g.,
for 3 outputs with the same error model:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>err <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="fu">replicate</span>(<span class="dv">3</span>, <span class="fu">proportional</span>(<span class="dv">2</span>, <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="dv">0</span>, <span class="dv">0</span>)))</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>)</span></code></pre><p></p></div></dd>


<dt><code>...</code></dt>
<dd><p>Not currently used.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-PM_model-print"></a><div class="section">
<h3 id="method-print-">Method <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code><a class="anchor" aria-label="anchor" href="#method-print-"></a></h3>
<p>Print the model summary.</p><div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">PM_model</span><span class="op">$</span><span class="fu">print</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>Not used.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="details-1">Details<a class="anchor" aria-label="anchor" href="#details-1"></a></h4>
<p>This method prints a summary of the model.</p>
</div>


</div><p></p><hr><a id="method-PM_model-plot"></a><div class="section">
<h3 id="method-plot-">Method <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code><a class="anchor" aria-label="anchor" href="#method-plot-"></a></h3>
<p>Plot the model.</p><div class="section">
<h4 id="usage-2">Usage<a class="anchor" aria-label="anchor" href="#usage-2"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">PM_model</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-2">Arguments<a class="anchor" aria-label="anchor" href="#arguments-2"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>Additional arguments passed to the plot function.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="details-2">Details<a class="anchor" aria-label="anchor" href="#details-2"></a></h4>
<p>This method plots the model using the
<code><a href="plot.PM_model.html">plot.PM_model()</a></code> function.</p>
</div>


</div><p></p><hr><a id="method-PM_model-fit"></a><div class="section">
<h3 id="method-fit-">Method <code>fit()</code><a class="anchor" aria-label="anchor" href="#method-fit-"></a></h3>
<p>This is the main method to run a population analysis.</p><div class="section">
<h4 id="usage-3">Usage<a class="anchor" aria-label="anchor" href="#usage-3"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">PM_model</span><span class="op">$</span><span class="fu">fit</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  path <span class="op">=</span> <span class="st">"."</span>,</span>
<span>  run <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  include <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  exclude <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cycles <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  prior <span class="op">=</span> <span class="st">"sobol"</span>,</span>
<span>  points <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  idelta <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  tad <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">23</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  algorithm <span class="op">=</span> <span class="st">"NPAG"</span>,</span>
<span>  report <span class="op">=</span> <span class="fu"><a href="../reference/getPMoptions.html">getPMoptions</a></span><span class="op">(</span><span class="st">"report_template"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-3">Arguments<a class="anchor" aria-label="anchor" href="#arguments-3"></a></h4>
<p></p><div class="arguments"><dl><dt><code>data</code></dt>
<dd><p>Either the name of a  <a href="PM_data.html">PM_data</a>
object in memory or the quoted filename (with or without a path) of a Pmetrics
data file. If the path is not specified, the file is assumed to be in the current working directory,
unless the <code>path</code> argument below is also specified as a global option for the fit.
The file will be used to create a <a href="PM_data.html">PM_data</a>
object on the fly. However, if created on the fly, this object
will not be available to other
methods or other instances of <code>$fit()</code>.</p></dd>


<dt><code>path</code></dt>
<dd><p>Optional full path or relative path from current working directory
to the folder where <code>data</code> and <code>model</code> are located if specified as filenames without
their own paths,
and where the output will be saved. Default is the current working directory.</p></dd>


<dt><code>run</code></dt>
<dd><p>Specify the run number of the output folder.  Default if missing is the next available number.</p></dd>


<dt><code>include</code></dt>
<dd><p>Vector of subject id values in the data file to include in the analysis.
The default (missing) is all.</p></dd>


<dt><code>exclude</code></dt>
<dd><p>A vector of subject IDs to exclude in the analysis, e.g. <code>c(4,6:14,16:20)</code></p></dd>


<dt><code>cycles</code></dt>
<dd><p>Number of cycles to run. Default is 100.</p></dd>


<dt><code>prior</code></dt>
<dd><p>The distribution for the initial support points, which can be
one of several options.</p><ul><li><p>The default is "sobol", which is a semi-random distribution. This is the distribution
typically used when fitting a new model to the data. An example of this is
on our <a href="https://www.lapk.org/images/sobol_3d_plot.html" class="external-link">website</a>.</p></li>
</ul><p>The following all specify non-random, informative prior distributions. They
are useful for either continuing a previous
run which did not converge or for fitting a model to new data, whether to simply
calculate Bayesian posteriors with <code>cycles = 0</code> or to revise the model to a new
covergence with the new data.</p><ul><li><p>The name of a suitable <a href="PM_result.html">PM_result</a> object from a prior run loaded with <a href="PM_load.html">PM_load</a>.
This starts from the non-uniform, informative distribution obtained at the end of a prior NPAG run.
Example: <code>run1 &lt;- PM_load(1); fit1$run(prior = run1)</code>.</p></li>
<li><p>A character string with the filename of a csv file containing a prior distribution with
format as for 'theta.csv' in the output folder of a prior run: column headers are parameter
names, and rows are the support point values. A final column with probabilities
for each support point is not necessary, but if present will be ignored, as these
probabilities are calculated by the engine. Note that the parameter names must match the
names of the primary variables in the model. Example: <code>fit1$run(prior = "mytheta.csv")</code>.</p></li>
<li><p>The number of a previous run with <code>theta.csv</code> in the output folder which will be read
as for the filename option above. Example: <code>fit1$run(prior = 2)</code>.</p></li>
<li><p>A data frame obtained from reading an approriate file, such that the data frame
is in the required format described in the filename option above. Example:
<code>mytheta &lt;- read_csv("mytheta.csv"); fit1$run(prior = mytheta)</code>.</p></li>
</ul></dd>


<dt><code>points</code></dt>
<dd><p>The number of initial support points if one of
the semi-random, uniform distributions are selected in the <code>prior</code> argument
above. Default is 100. The initial points are
spread through the hyperspace defined by the random parameter ranges
and begin the search for the optimal
parameter value distribution (support points) in the population.
If there are fewer than 2 points per unit range for any parameter,
Pmetrics will suggest the minimum number of points that should be tried.
The greater the initial number of points, the less chance of
missing the globally maximally likely parameter value distribution,
but the slower the run.</p></dd>


<dt><code>idelta</code></dt>
<dd><p>How often to generate posterior predictions in units of time.
Default is 0.1, which means a prediction is generated every 0.1 hours (6 minutes)
if the unit of time is hours. Predictions are made at this interval until the time
of the last event (dose or observation) or until <code>tad</code> if that value is greater
than the time of the last dose or observation in the data.</p></dd>


<dt><code>tad</code></dt>
<dd><p>Length of time after the last dose event to add additional predictions
at frequency <code>idelta</code>.  Default is 0, which means no additional predictions
beyond the last dose, assuming the dose is the last event. . If the
last observation in the data is after <code>tad</code>, then a prediction will be generated at
time = <code>tad</code> after the last dose</p></dd>


<dt><code>seed</code></dt>
<dd><p>Seed used if <code>prior = "sobol"</code>. Ignored otherwise.</p></dd>


<dt><code>overwrite</code></dt>
<dd><p>Boolean operator to overwrite existing run result folders.  Default is <code>FALSE</code>.</p></dd>


<dt><code>algorithm</code></dt>
<dd><p>The algorithm to use for the run.  Default is "NPAG" for the <strong>N</strong>on-<strong>P</strong>arametric <strong>A</strong>daptive <strong>G</strong>rid. Alternatives: "NPOD".</p></dd>


<dt><code>report</code></dt>
<dd><p>If missing, the default Pmetrics report template as specified in <a href="getPMoptions.html">getPMoptions</a>
is used. Otherwise can be "plotly", "ggplot", or "none".</p></dd>


<dt><code>intern</code></dt>
<dd><p>Run NPAG in the R console without a batch script.  Default is TRUE.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="details-3">Details<a class="anchor" aria-label="anchor" href="#details-3"></a></h4>
<p>As of Pmetrics 3.0.0, models contain compiled code to fit
the model equations to the data, optimizing the parameter
value probability distributions in the population to
maximize their likelihood, or more precisely, minimize
the objective function, which is -2*log-likelihood.</p>
<p>The <code>$fit()</code> method is the means of running that compiled
code to conduct to fitting procedure. At a minimum, it requires
a <a href="PM_data.html">PM_data</a> object, which can be created with
<code>PM_data$new()</code>. There are a number of additional arguments
to control the fitting procedure, such as the number of cycles
to run, the initial number of support points,
and the algorithm to use, among others.</p>
<p>The <code>$fit()</code> method is the descendant of the legacy
<a href="NPrun.html">NPrun</a> function, which is maintained as a wrapper to <code>$fit()</code>
for backwards compatibility.</p>
</div>

<div class="section">
<h4 id="returns">Returns<a class="anchor" aria-label="anchor" href="#returns"></a></h4>
<p>A successful run will result in creation of a new folder in the working
directory with the results inside the folder.</p>
</div>

</div><p></p><hr><a id="method-PM_model-map"></a><div class="section">
<h3 id="method-map-">Method <code>map()</code><a class="anchor" aria-label="anchor" href="#method-map-"></a></h3>
<p>Calculate posteriors from a fitted model.
#' @details
This method calculates posteriors from a compiled model. It is not necessary to have
run the model first, but it is necessary to have an informative prior distribution.
This prior will typically be the result of a previous run, but may also be a file
containing support points, with each column named as a parameter in the model plus a final column
for probability.  Each row contains values for the parameters and the associated probability for
those parameter values.  The file can be saved as a csv file.</p>
<p>To calculate the posteriors, <code>map()</code> calls the <code>fit()</code> method with the <code>cycles</code> argument set to 0
and the <code>algorithm</code> argument set to "POSTPROB". If <code>data</code> are not provided as an argument to
<code>map()</code>, the model's <code>data</code> field is used instead. If <code>data</code> is provided, it must be a
<a href="PM_data.html">PM_data</a> object or the pathname of a file which can be loaded as a <a href="PM_data.html">PM_data</a> object.</p><div class="section">
<h4 id="usage-4">Usage<a class="anchor" aria-label="anchor" href="#usage-4"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">PM_model</span><span class="op">$</span><span class="fu">map</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-4">Arguments<a class="anchor" aria-label="anchor" href="#arguments-4"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>Arguments passed to the <code>fit</code> method. Note that the <code>cycles</code> argument is set to 0,
and the <code>algorithm</code> argument is set to "POSTPROB" automatically.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-PM_model-sim"></a><div class="section">
<h3 id="method-sim-">Method <code>sim()</code><a class="anchor" aria-label="anchor" href="#method-sim-"></a></h3>
<p>Simulate data from the model using a set of parameter values.</p><div class="section">
<h4 id="usage-5">Usage<a class="anchor" aria-label="anchor" href="#usage-5"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">PM_model</span><span class="op">$</span><span class="fu">sim</span><span class="op">(</span><span class="va">data</span>, <span class="va">theta</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-5">Arguments<a class="anchor" aria-label="anchor" href="#arguments-5"></a></h4>
<p></p><div class="arguments"><dl><dt><code>data</code></dt>
<dd><p>A <a href="PM_data.html">PM_data</a> object containing the dosing and observation information.</p></dd>


<dt><code>theta</code></dt>
<dd><p>A matrix of parameter values to use for the simulation.
The <code>theta</code> matrix should have the same number of columns as the number of primary parameters in the model.
Each row of <code>theta</code> represents a different set of parameter values.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="details-4">Details<a class="anchor" aria-label="anchor" href="#details-4"></a></h4>
<p>This method simulates output from the model using a set of parameter values
provided in the <code>theta</code> matrix and the template for dosing/observations in
the <code>data</code> object.</p>
</div>


</div><p></p><hr><a id="method-PM_model-compile"></a><div class="section">
<h3 id="method-compile-">Method <code>compile()</code><a class="anchor" aria-label="anchor" href="#method-compile-"></a></h3>
<p>Compile the model to a binary file.</p><div class="section">
<h4 id="usage-6">Usage<a class="anchor" aria-label="anchor" href="#usage-6"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">PM_model</span><span class="op">$</span><span class="fu">compile</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="details-5">Details<a class="anchor" aria-label="anchor" href="#details-5"></a></h4>
<p>This method write the model to a Rust file in a temporary path,
updates the <code>binary_path</code> field for the model, and compiles that
file to a binary file that can be used for fitting or simulation.
If the model is already compiled, the method does nothing.</p>
</div>


</div><p></p><hr><a id="method-PM_model-update"></a><div class="section">
<h3 id="method-update-">Method <code><a href="https://rdrr.io/r/stats/update.html" class="external-link">update()</a></code><a class="anchor" aria-label="anchor" href="#method-update-"></a></h3>
<p>Update the model using recursive lists of changes and recompile the updated model.</p><div class="section">
<h4 id="usage-7">Usage<a class="anchor" aria-label="anchor" href="#usage-7"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">PM_model</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-6">Arguments<a class="anchor" aria-label="anchor" href="#arguments-6"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>Named elements corresponding to the blocks in the model,
such as "pri", "cov", "sec", "eqn", "ini", "lag", "fa", "out", and "err".
For each block, create a list of changes, which may be additions, edits, or deletions.
For deletions, set the value to <code>NULL</code>.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-PM_model-clone"></a><div class="section">
<h3 id="method-clone-">Method <code>clone()</code><a class="anchor" aria-label="anchor" href="#method-clone-"></a></h3>
<p>The objects of this class are cloneable with this method.</p><div class="section">
<h4 id="usage-8">Usage<a class="anchor" aria-label="anchor" href="#usage-8"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">PM_model</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-7">Arguments<a class="anchor" aria-label="anchor" href="#arguments-7"></a></h4>
<p></p><div class="arguments"><dl><dt><code>deep</code></dt>
<dd><p>Whether to make a deep clone.</p></dd>


</dl><p></p></div>
</div>

</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">mod_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  pri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>     CL <span class="op">=</span> <span class="fu"><a href="ab.html">ab</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">200</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     V0 <span class="op">=</span> <span class="fu"><a href="ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     ka <span class="op">=</span> <span class="fu"><a href="ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     k23 <span class="op">=</span> <span class="fu"><a href="ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     k32 <span class="op">=</span> <span class="fu"><a href="ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     lag1 <span class="op">=</span> <span class="fu"><a href="ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="op">)</span>,</span></span>
<span class="r-in"><span>   cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>     wt <span class="op">=</span> <span class="fu"><a href="interp.html">interp</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="op">)</span>,</span></span>
<span class="r-in"><span>   sec <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>     <span class="va">V</span> <span class="op">=</span> <span class="va">V0</span> <span class="op">*</span> <span class="op">(</span><span class="va">wt</span><span class="op">/</span><span class="fl">70</span><span class="op">)</span></span></span>
<span class="r-in"><span>     <span class="va">ke</span> <span class="op">=</span> <span class="va">CL</span><span class="op">/</span><span class="va">V</span> <span class="co"># define here to make eqn simpler</span></span></span>
<span class="r-in"><span>   <span class="op">}</span>,</span></span>
<span class="r-in"><span>   eqn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>     <span class="va">dx</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="op">-</span><span class="va">ka</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span>     <span class="va">dx</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="va">rateiv</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">ka</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="op">(</span><span class="va">ke</span> <span class="op">+</span> <span class="va">k23</span><span class="op">)</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">k32</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span></span>
<span class="r-in"><span>     <span class="va">dx</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">=</span> <span class="va">k23</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">k32</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span></span>
<span class="r-in"><span>     <span class="va">dx</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="va">V</span></span></span>
<span class="r-in"><span>   <span class="op">}</span>,</span></span>
<span class="r-in"><span>   lag <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>     <span class="va">tlag</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">lag1</span></span></span>
<span class="r-in"><span>   <span class="op">}</span>,</span></span>
<span class="r-in"><span>   out <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>     <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="va">V</span></span></span>
<span class="r-in"><span>     <span class="va">y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="co"># AUC, not fitted to any data, not required</span></span></span>
<span class="r-in"><span>   <span class="op">}</span>,</span></span>
<span class="r-in"><span>   err <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>     <span class="fu"><a href="proportional.html">proportional</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="co"># only applies to y[1]</span></span></span>
<span class="r-in"><span>   <span class="op">)</span></span></span>
<span class="r-in"><span> <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span>   <span class="va">mod</span> <span class="op">&lt;-</span> <span class="va">PM_model</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">mod_list</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in initialize(...):</span> <span style="color: #BB0000;">✖</span> There must be one error model for each output equation.</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Please check the error model.</span>
<span class="r-in"><span> <span class="co"># } </span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Neely, Julián Otálvaro.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

