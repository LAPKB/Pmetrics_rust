{"title":"Simulations","markdown":{"headingText":"Simulations","containsRefs":false,"markdown":"```{r}\n#| eval: true\n#| echo: false\n#| message: false\n#library(Pmetrics)\ndevtools::load_all()\n```\n\n\n```{r}\n#| label: setup\n#| include: false\n#| echo: false\n#| eval: true\n\nexData <- PM_data$new(data = \"../Examples/src/ex.csv\", loq = 1)\nmod1 <- PM_model$new(\"../Examples/src/model.txt\")\nrun2 <- PM_load(file = \"../Examples/Runs/2/outputs/PMout.Rdata\")\n```\n\n\n\n::: {.callout-tip} \n## Learn more\nRefer to the reference article: [Simulation](https://lapkb.github.io/Pmetrics/articles/simulation.html) \n:::\n\n## Basic simulation\n\nThe following will simulate 100 sets of parameters/concentrations using the model, population parameter values,\nfirst subject in the data all attached to `run1` (exercise on [first NPAG run](NPAG.qmd)).\n\nSetting `limits = NA` makes the simulated parameter values stay within the same ranges as in the model for `run1`.\n\n```{r}\n#| eval: true\nsimdata <- run2$sim(include = 1, limits = NA, nsim = 100)\n```\n\nBelow is the alternate way to simulate, which is particularly useful if you define \nyour own population parameters. See `?PM_sim` for details on this as well as\nthe article on simulation.\n\n```{r}\n#| eval: true\n\n# define population parameters for simulation\npoppar <- list(\n  mean = list(ka = 0.6, ke = 0.05, v = 77.8, lag1 = 1.2),\n  cov = diag(c(0.07, 0.0004, 830, 0.45))\n)\n\n# now we need to provide parameter value distributions (poppar), data, and model\nsimOther <- PM_sim$new(poppar = poppar, data = exData, model = mod1,\n                       include = 1, limits = NA, nsim = 100)\n```\n\nSimulate from a model with new data.\n\n```{r}\n#| eval: true\nsim_new <- run2$sim(\n  data = \"../Examples/src/ptaex1.csv\",\n  include = 2, limits = NA,\n  predInt = c(120, 144, 1)\n)\n```\n\n\n\n\nPlot them; `?plot.PM_sim` for help.\n\n```{r}\n#| eval: true\nsimdata$plot() %>% plotlygg()\nsimOther$plot() %>% plotlygg()\nsim_new$plot(log = FALSE) %>% plotlygg()\n```\n\n\nSimulate using multiple subjects as templates.\n\n```{r}\n#| eval: true\nsimdata <- run2$sim(include = 1:4, limits = NA, nsim = 100)\n```\n\nPlot the third simulation; use include/exclude to specify the ID numbers, which are the same as the ID numbers in the template data file\n\n\n```{r}\n#| eval: true\nsimdata$plot(include = 3) %>% plotlygg() # one regimen\nsimdata$plot(exclude = 3) %>% plotlygg() # all but one regimen; notice the jagged profiles arising from combining different regimens\n```\n\n\n\n\n## Simulate with covariates\nIn this case we use the covariate-parameter correlations from run 2, which are found in the `cov` field. We re-define the mean weight to be 50 with SD of 20, and limits of 10 to 70 kg.  We fix africa, gender and height covariates, but allow age (the last covariate) to be simulated, using the mean, sd, and limits in the original population, since we didn't specify them. See ?SIMrun for more help on this.\n\n```{r}\n#| eval: true\ncovariate <- list(\n  cov = run2$cov,\n  mean = list(wt = 50),\n  sd = list(wt = 20),\n  limits = list(wt = c(10, 70)),\n  fix = c(\"africa\", \"gender\", \"height\")\n)\n```\n\n\n\nNow simulate with this covariate list object.\n\n```{r}\n#| eval: true\nsimdata3 <- run2$sim(include = 1:4, limits = NA, nsim = 100, covariate = covariate)\n\n```\n\nThere are subtle differences between simulations with and without covariates simulated, all other inputs the same.\n\n```{r}\n#| eval: true\nsimdata$plot(include = 4) %>% plotlygg() # without covariates\nsimdata3$plot(include = 4) %>% plotlygg() # ...and with covariates simulated\n```\n\n\n\nHere are the simulated parameters and covariates for the first subject's\ntemplate; note that both wt and age are simulated, using proper covariances\nwith simulated PK parameters.\n\n```{r}\n#| eval: true\nsimdata3$data$parValues\n```\n\nWe can summarize simulations too. See `?summary.PM_sim` for help.\n\n```{r}\n#| eval: true\nsimdata3$summary(field = \"obs\", include = 3)\n```\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":false,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":true,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"include-in-header":["copy-all-code.html"],"output-file":"Simulate.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.56","pdf":{"documentclass":"scrreprt"},"theme":"cosmo"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}