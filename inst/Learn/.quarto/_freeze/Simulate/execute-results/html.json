{
  "hash": "b5eb86ca955d867e638487e0012b7f31",
  "result": {
    "engine": "knitr",
    "markdown": "::: {.cell}\n\n:::\n\n\n\n\n\n\n\n\n# Simulations\n\n::: {.callout-tip} \n## Learn more\nRefer to the reference article: [Simulation](https://lapkb.github.io/Pmetrics/articles/simulation.html) \n:::\n\n## Basic simulation\n\nThe following will simulate 100 sets of parameters/concentrations using the model, population parameter values,\nfirst subject in the data all attached to `run1` (exercise on [first NPAG run](NPAG.qmd)).\n\nSetting `limits = NA` makes the simulated parameter values stay within the same ranges as in the model for `run1`.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimdata <- run2$sim(include = 1, limits = NA, nsim = 100)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDATA STANDARDIZATION REPORT:\n\n EVID inferred as 0 for observations, 1 for doses.\n All doses assumed to be oral (DUR = 0).\n ADDL set to missing for all records.\n II set to missing for all records.\n All doses assumed to be INPUT = 1.\n All observations assumed to be OUTEQ = 1.\n One or more error coefficients not specified. Error in model object will be used.\n\nDATA VALIDATION REPORT:\n\nNo data errors found.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nℹ FIX DATA REPORT:\nThere were no errors to fix in your data file.\n```\n\n\n:::\n:::\n\n\n\n\n\nBelow is the alternate way to simulate, which is particularly useful if you define \nyour own population parameters. See `?PM_sim` for details on this as well as\nthe article on simulation.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# define population parameters for simulation\npoppar <- list(\n  mean = list(ka = 0.6, ke = 0.05, v = 77.8, lag1 = 1.2),\n  cov = diag(c(0.07, 0.0004, 830, 0.45))\n)\n\n# now we need to provide parameter value distributions (poppar), data, and model\nsimOther <- PM_sim$new(poppar = poppar, data = exData, model = mod1,\n                       include = 1, limits = NA, nsim = 100)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDATA STANDARDIZATION REPORT:\n\n EVID inferred as 0 for observations, 1 for doses.\n All doses assumed to be oral (DUR = 0).\n ADDL set to missing for all records.\n II set to missing for all records.\n All doses assumed to be INPUT = 1.\n All observations assumed to be OUTEQ = 1.\n One or more error coefficients not specified. Error in model object will be used.\n\nDATA VALIDATION REPORT:\n\nNo data errors found.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nℹ FIX DATA REPORT:\nThere were no errors to fix in your data file.\n```\n\n\n:::\n:::\n\n\n\n\n\nSimulate from a model with new data.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsim_new <- run2$sim(\n  data = \"../Examples/src/ptaex1.csv\",\n  include = 2, limits = NA,\n  predInt = c(120, 144, 1)\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDATA STANDARDIZATION REPORT:\n\n ADDL > 0 rows expanded.\n\nDATA VALIDATION REPORT:\n\nNo data errors found.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nℹ FIX DATA REPORT:\nThere were no errors to fix in your data file.\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\nPlot them; `?plot.PM_sim` for help.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimdata$plot() %>% plotlygg()\n```\n\n::: {.cell-output-display}\n![](Simulate_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsimOther$plot() %>% plotlygg()\n```\n\n::: {.cell-output-display}\n![](Simulate_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n\n```{.r .cell-code}\nsim_new$plot(log = FALSE) %>% plotlygg()\n```\n\n::: {.cell-output-display}\n![](Simulate_files/figure-html/unnamed-chunk-5-3.png){width=672}\n:::\n:::\n\n\n\n\n\n\nSimulate using multiple subjects as templates.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimdata <- run2$sim(include = 1:4, limits = NA, nsim = 100)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDATA STANDARDIZATION REPORT:\n\n EVID inferred as 0 for observations, 1 for doses.\n All doses assumed to be oral (DUR = 0).\n ADDL set to missing for all records.\n II set to missing for all records.\n All doses assumed to be INPUT = 1.\n All observations assumed to be OUTEQ = 1.\n One or more error coefficients not specified. Error in model object will be used.\n\nDATA VALIDATION REPORT:\n\nNo data errors found.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nℹ FIX DATA REPORT:\nThere were no errors to fix in your data file.\n```\n\n\n:::\n:::\n\n\n\n\n\nPlot the third simulation; use include/exclude to specify the ID numbers, which are the same as the ID numbers in the template data file\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimdata$plot(include = 3) %>% plotlygg() # one regimen\n```\n\n::: {.cell-output-display}\n![](Simulate_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsimdata$plot(exclude = 3) %>% plotlygg() # all but one regimen; notice the jagged profiles arising from combining different regimens\n```\n\n::: {.cell-output-display}\n![](Simulate_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n:::\n\n\n\n\n\n\n\n\n## Simulate with covariates\nIn this case we use the covariate-parameter correlations from run 2, which are found in the `cov` field. We re-define the mean weight to be 50 with SD of 20, and limits of 10 to 70 kg.  We fix africa, gender and height covariates, but allow age (the last covariate) to be simulated, using the mean, sd, and limits in the original population, since we didn't specify them. See ?SIMrun for more help on this.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncovariate <- list(\n  cov = run2$cov,\n  mean = list(wt = 50),\n  sd = list(wt = 20),\n  limits = list(wt = c(10, 70)),\n  fix = c(\"africa\", \"gender\", \"height\")\n)\n```\n:::\n\n\n\n\n\n\n\nNow simulate with this covariate list object.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimdata3 <- run2$sim(include = 1:4, limits = NA, nsim = 100, covariate = covariate)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDATA STANDARDIZATION REPORT:\n\n EVID inferred as 0 for observations, 1 for doses.\n All doses assumed to be oral (DUR = 0).\n ADDL set to missing for all records.\n II set to missing for all records.\n All doses assumed to be INPUT = 1.\n All observations assumed to be OUTEQ = 1.\n One or more error coefficients not specified. Error in model object will be used.\n\nDATA VALIDATION REPORT:\n\nNo data errors found.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nℹ FIX DATA REPORT:\nThere were no errors to fix in your data file.\n```\n\n\n:::\n:::\n\n\n\n\n\nThere are subtle differences between simulations with and without covariates simulated, all other inputs the same.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimdata$plot(include = 4) %>% plotlygg() # without covariates\n```\n\n::: {.cell-output-display}\n![](Simulate_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsimdata3$plot(include = 4) %>% plotlygg() # ...and with covariates simulated\n```\n\n::: {.cell-output-display}\n![](Simulate_files/figure-html/unnamed-chunk-10-2.png){width=672}\n:::\n:::\n\n\n\n\n\n\n\nHere are the simulated parameters and covariates for the first subject's\ntemplate; note that both wt and age are simulated, using proper covariances\nwith simulated PK parameters.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimdata3$data$parValues\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 100 × 7\n    nsim    ka     ke  lag1    v0   age    wt\n   <int> <dbl>  <dbl> <dbl> <dbl> <dbl> <dbl>\n 1     1 0.876 0.0307  1.28 119.   26.0  59.0\n 2     2 0.885 0.0272  1.29 113.   26.7  53.1\n 3     3 0.893 0.0351  1.22 112.   27.9  43.2\n 4     4 0.899 0.0325  1.22 120.   26.7  54.5\n 5     5 0.893 0.0329  1.22 119.   28.8  48.8\n 6     6 0.834 0.0319  1.51 116.   26.9  46.8\n 7     7 0.895 0.0287  1.21 108.   26.3  56.9\n 8     8 0.896 0.0237  1.18 120.   29.3  53.4\n 9     9 0.879 0.0289  1.21 119.   30.2  44.3\n10    10 0.756 0.0597  2.85  52.3  27.7  53.4\n# ℹ 90 more rows\n```\n\n\n:::\n:::\n\n\n\n\n\nWe can summarize simulations too. See `?summary.PM_sim` for help.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimdata3$summary(field = \"obs\", include = 3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    stat     time     out outeq\n1   mean 127.7914  8.1614     1\n2     sd   7.8035  3.8361     0\n3 median 126.0800  7.4558     1\n4    min 120.0800  1.3813     1\n5    max 144.0800 24.6119     1\n```\n\n\n:::\n:::\n",
    "supporting": [
      "Simulate_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}