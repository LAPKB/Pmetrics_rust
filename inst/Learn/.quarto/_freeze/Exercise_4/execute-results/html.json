{
  "hash": "426bb5ff56d51a7121667c7c76e4ee62",
  "result": {
    "engine": "knitr",
    "markdown": "::: {.cell}\n\n:::\n\n\n\n\n\n\n\n\n# Simulations\n\nLinked reference article:\n* [Simulation](https://lapkb.github.io/Pmetrics/articles/simulation.html)\n\n## Basic simulation\n\nThe following will simulate 100 sets of parameters/concentrations using the\nfirst subject in the data file as a template.\n\nLimits are put on the simulated parameter ranges to be the same as in the model.\nThe population parameter values from the NPAG run in exercise 2 are used for the Monte Carlo Simulation.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimdata <- run2$sim(include = 1, limits = NA, nsim = 100)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDATA STANDARDIZATION REPORT:\n\n EVID inferred as 0 for observations, 1 for doses.\n All doses assumed to be oral (DUR = 0).\n ADDL set to missing for all records.\n II set to missing for all records.\n All doses assumed to be INPUT = 1.\n All observations assumed to be OUTEQ = 1.\n One or more error coefficients not specified. Error in model object will be used.\n\nDATA VALIDATION REPORT:\n\nNo data errors found.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nℹ FIX DATA REPORT:\nThere were no errors to fix in you data file.\n```\n\n\n:::\n:::\n\n\n\n\n\nBelow is the alternate way to simulate, which is particularly useful if you define \nyour own population parameters. See `?PM_sim` for details on this as well as\nthe article on simulation.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# define population parameters for simulation\npoppar <- list(\n  mean = list(ka = 0.6, ke = 0.05, v = 77.8, lag1 = 1.2),\n  cov = diag(c(0.07, 0.0004, 830, 0.45))\n)\n\n# now we need to provide parameter value distributions (poppar), data, and model\nsimOther <- PM_sim$new(poppar = poppar, data = exData, model = mod1,\n                       include = 1, limits = NA, nsim = 100)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDATA STANDARDIZATION REPORT:\n\n EVID inferred as 0 for observations, 1 for doses.\n All doses assumed to be oral (DUR = 0).\n ADDL set to missing for all records.\n II set to missing for all records.\n All doses assumed to be INPUT = 1.\n All observations assumed to be OUTEQ = 1.\n One or more error coefficients not specified. Error in model object will be used.\n\nDATA VALIDATION REPORT:\n\nNo data errors found.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nℹ FIX DATA REPORT:\nThere were no errors to fix in you data file.\n```\n\n\n:::\n:::\n\n\n\n\n\nSimulate from a model with new data.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsim_new <- run2$sim(\n  data = \"../Examples/src/ptaex1.csv\",\n  include = 2, limits = NA,\n  predInt = c(120, 144, 1)\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDATA STANDARDIZATION REPORT:\n\n ADDL > 0 rows expanded.\n\nDATA VALIDATION REPORT:\n\nNo data errors found.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nℹ FIX DATA REPORT:\nThere were no errors to fix in you data file.\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\nPlot them; `?plot.PM_sim` for help.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimdata$plot() %>% plotlygg()\n```\n\n::: {.cell-output-display}\n![](Exercise_4_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsimOther$plot() %>% plotlygg()\n```\n\n::: {.cell-output-display}\n![](Exercise_4_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n\n```{.r .cell-code}\nsim_new$plot(log = FALSE) %>% plotlygg()\n```\n\n::: {.cell-output-display}\n![](Exercise_4_files/figure-html/unnamed-chunk-5-3.png){width=672}\n:::\n:::\n\n\n\n\n\n\nSimulate using multiple subjects as templates.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimdata <- run2$sim(include = 1:4, limits = NA, nsim = 100)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDATA STANDARDIZATION REPORT:\n\n EVID inferred as 0 for observations, 1 for doses.\n All doses assumed to be oral (DUR = 0).\n ADDL set to missing for all records.\n II set to missing for all records.\n All doses assumed to be INPUT = 1.\n All observations assumed to be OUTEQ = 1.\n One or more error coefficients not specified. Error in model object will be used.\n\nDATA VALIDATION REPORT:\n\nNo data errors found.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nℹ FIX DATA REPORT:\nThere were no errors to fix in you data file.\n```\n\n\n:::\n:::\n\n\n\n\n\nPlot the third simulation; use include/exclude to specify the ID numbers, which are the same as the ID numbers in the template data file\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimdata$plot(include = 3) %>% plotlygg() # one regimen\n```\n\n::: {.cell-output-display}\n![](Exercise_4_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsimdata$plot(exclude = 3) %>% plotlygg() # all but one regimen; notice the jagged profiles arising from combining different regimens\n```\n\n::: {.cell-output-display}\n![](Exercise_4_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n:::\n\n\n\n\n\n\n\n\n## Simulate with covariates\nIn this case we use the covariate-parameter correlations from run 2, which are found in the `cov` field. We re-define the mean weight to be 50 with SD of 20, and limits of 10 to 70 kg.  We fix africa, gender and height covariates, but allow age (the last covariate) to be simulated, using the mean, sd, and limits in the original population, since we didn't specify them. See ?SIMrun for more help on this.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncovariate <- list(\n  cov = run2$cov,\n  mean = list(wt = 50),\n  sd = list(wt = 20),\n  limits = list(wt = c(10, 70)),\n  fix = c(\"africa\", \"gender\", \"height\")\n)\n```\n:::\n\n\n\n\n\n\n\nNow simulate with this covariate list object.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimdata3 <- run2$sim(include = 1:4, limits = NA, nsim = 100, covariate = covariate)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDATA STANDARDIZATION REPORT:\n\n EVID inferred as 0 for observations, 1 for doses.\n All doses assumed to be oral (DUR = 0).\n ADDL set to missing for all records.\n II set to missing for all records.\n All doses assumed to be INPUT = 1.\n All observations assumed to be OUTEQ = 1.\n One or more error coefficients not specified. Error in model object will be used.\n\nDATA VALIDATION REPORT:\n\nNo data errors found.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nℹ FIX DATA REPORT:\nThere were no errors to fix in you data file.\n```\n\n\n:::\n:::\n\n\n\n\n\n# compare difference in simulations without covariates simulated...\n# PM_sim's plot function defaults to the first simulation if there\n# are multiple simulations and \"at\" is not specified.\nsimdata$plot()\n\n# ...and with covariates simulated\nsimdata3$plot()\n\n# Here are the simulated parameters and covariates for the first subject's\n# template; note that both wt and age are simulated, using proper covariances\n# with simulated PK parameters\nsimdata3$data$parValues\n\n# We can summarize simulations too. See ?summary.PM_sim for help.\nsimdata3$summary(field = \"obs\", include = 3)\n\n# look in the working directory and find the \"c_simdata.csv\" and \"c_simmodel.txt\" files\n# which were made when you simulated with covariates.  Compare to original\n# \"simdata.csv\" and \"simmoddel.txt\" files to note that simulated covariates become\n# Primary block variables, and are removed from the template data file.",
    "supporting": [
      "Exercise_4_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}