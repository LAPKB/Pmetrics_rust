<button id="copy-all-code"
        style="position:fixed;top:1rem;right:1rem;z-index:2000;
               padding:.35rem .6rem;border:0;border-radius:.25rem;
               background:#2563eb;color:white;cursor:pointer;">
  Copy all code
</button>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const btn = document.getElementById('copy-all-code');
  const grab = () =>
    Array.from(document.querySelectorAll('div.sourceCode pre code, pre > code.sourceCode'))
         .map(n => n.innerText).join('\n\n');

  const copyText = async (txt) => {
    // Prefer Clipboard API; fallback to hidden <textarea> for viewers/file://
    if (navigator.clipboard && window.isSecureContext) {
      return navigator.clipboard.writeText(txt);
    } else {
      const ta = document.createElement('textarea');
      ta.value = txt; ta.style.position = 'fixed'; ta.style.opacity = '0';
      document.body.appendChild(ta); ta.focus(); ta.select();
      try { document.execCommand('copy'); } finally { document.body.removeChild(ta); }
    }
  };

  btn.addEventListener('click', async () => {
    try {
      await copyText(grab());
      const old = btn.textContent; btn.textContent = 'Copied!'; setTimeout(() => btn.textContent = old, 1200);
    } catch(e) { alert('Copy failed: ' + e); }
  });
});
</script>
